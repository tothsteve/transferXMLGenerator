[phases.setup]
nixPkgs = ["nodejs-18_x"]

[phases.install]
cmds = [
  "npm ci --prefer-offline --no-audit --silent --no-fund --no-optional",
  "npm cache clean --force"
]
cacheDirectories = [".npm", "node_modules"]

[phases.build]
cmds = [
  "export NODE_ENV=production",
  "export GENERATE_SOURCEMAP=false",
  "export CI=false",
  "export DISABLE_ESLINT_PLUGIN=true",
  "export TSC_COMPILE_ON_ERROR=true",
  "export SKIP_PREFLIGHT_CHECK=true",
  "npm run build:fast"
]
cacheDirectories = ["node_modules/.cache", "build"]

[start]
cmd = "npm run serve"